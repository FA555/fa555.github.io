<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="2020 Apr Records"><meta name="keywords" content=""><meta name="author" content="fa_555"><meta name="copyright" content="fa_555"><title>2020 Apr Records | fa_555's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 7.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#SCOI2007-k%E7%9F%AD%E8%B7%AF"><span class="toc-number">1.</span> <span class="toc-text">[SCOI2007]k短路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#solution"><span class="toc-number">1.1.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code"><span class="toc-number">1.2.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NOI2005-%E6%99%BA%E6%85%A7%E7%8F%A0%E6%B8%B8%E6%88%8F"><span class="toc-number">2.</span> <span class="toc-text">[NOI2005]智慧珠游戏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#code-1"><span class="toc-number">2.1.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6"><span class="toc-number">3.</span> <span class="toc-text">数学</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BSGS"><span class="toc-number">4.</span> <span class="toc-text">BSGS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E6%A0%B9"><span class="toc-number">5.</span> <span class="toc-text">原根</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SDOI2010-%E5%8F%A4%E4%BB%A3%E7%8C%AA%E6%96%87"><span class="toc-number">6.</span> <span class="toc-text">[SDOI2010]古代猪文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem"><span class="toc-number">6.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-1"><span class="toc-number">6.2.</span> <span class="toc-text">solution</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Extended-Lucas"><span class="toc-number">6.2.1.</span> <span class="toc-text">Extended Lucas</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Lucas-CRT"><span class="toc-number">6.2.2.</span> <span class="toc-text">Lucas + CRT</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-2"><span class="toc-number">6.3.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HAOI2011-Problem-b"><span class="toc-number">7.</span> <span class="toc-text">[HAOI2011]Problem b</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-1"><span class="toc-number">7.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-2"><span class="toc-number">7.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LCMSUM"><span class="toc-number">8.</span> <span class="toc-text">LCMSUM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-2"><span class="toc-number">8.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-3"><span class="toc-number">8.2.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-3"><span class="toc-number">8.3.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crash%E7%9A%84%E6%95%B0%E5%AD%97%E8%A1%A8%E6%A0%BC"><span class="toc-number">9.</span> <span class="toc-text">Crash的数字表格</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-3"><span class="toc-number">9.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-4"><span class="toc-number">9.2.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-4"><span class="toc-number">9.3.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SDOI2015%E7%BA%A6%E6%95%B0%E4%B8%AA%E6%95%B0%E5%92%8C"><span class="toc-number">10.</span> <span class="toc-text">[SDOI2015约数个数和]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-4"><span class="toc-number">10.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-5"><span class="toc-number">10.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ZJOI2014-%E5%8A%9B"><span class="toc-number">11.</span> <span class="toc-text">[ZJOI2014]力</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-5"><span class="toc-number">11.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-6"><span class="toc-number">11.2.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-5"><span class="toc-number">11.3.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AHOI2017-HNOI2017-%E7%A4%BC%E7%89%A9"><span class="toc-number">12.</span> <span class="toc-text">[AHOI2017&#x2F;HNOI2017]礼物</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-7"><span class="toc-number">12.1.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-6"><span class="toc-number">12.2.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SP4882-DAGCNT2-Counting-in-a-DAG"><span class="toc-number">13.</span> <span class="toc-text">SP4882 DAGCNT2 - Counting in a DAG</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-6"><span class="toc-number">13.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-8"><span class="toc-number">13.2.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-7"><span class="toc-number">13.3.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AE%8B%E7%BC%BA%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">14.</span> <span class="toc-text">残缺的字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-7"><span class="toc-number">14.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-%E5%8D%95%E6%A8%A1%E5%BC%8F%E4%B8%B2%E5%8C%B9%E9%85%8D"><span class="toc-number">14.2.</span> <span class="toc-text">solution - 单模式串匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-%E5%B8%A6%E9%80%9A%E9%85%8D%E7%AC%A6%E7%9A%84%E5%8D%95%E6%A8%A1%E5%BC%8F%E4%B8%B2%E5%8C%B9%E9%85%8D"><span class="toc-number">14.3.</span> <span class="toc-text">solution - 带通配符的单模式串匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-8"><span class="toc-number">14.4.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E8%AE%AD%E9%98%9F%E4%BD%9C%E4%B8%9A2013-%E5%9F%8E%E5%B8%82%E8%A7%84%E5%88%92"><span class="toc-number">15.</span> <span class="toc-text">[集训队作业2013]城市规划</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-8"><span class="toc-number">15.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-9"><span class="toc-number">15.2.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-9"><span class="toc-number">15.3.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF662C-Binary-Table"><span class="toc-number">16.</span> <span class="toc-text">CF662C Binary Table</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-9"><span class="toc-number">16.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-10"><span class="toc-number">16.2.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-10"><span class="toc-number">16.3.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF850E-Random-Elections"><span class="toc-number">17.</span> <span class="toc-text">CF850E Random Elections</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-10"><span class="toc-number">17.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-11"><span class="toc-number">17.2.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-11"><span class="toc-number">17.3.</span> <span class="toc-text">code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#P5816-CQOI2010-%E5%86%85%E9%83%A8%E7%99%BD%E7%82%B9"><span class="toc-number">17.4.</span> <span class="toc-text">P5816 [CQOI2010]内部白点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#problem-11"><span class="toc-number">17.5.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#solution-12"><span class="toc-number">17.6.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#code-12"><span class="toc-number">17.7.</span> <span class="toc-text">code</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">18.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars.githubusercontent.com/u/29965600"></div><div class="author-info__name text-center">fa_555</div><div class="author-info__description text-center">夢の続きを知りたいのかい？</div><div class="follow-button"><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/user/111890">Luogu</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">31</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">18</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">8</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://github.com/FA555">Github</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://codeforces.com/profile/fa_555">Codeforces</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/files/topimg/johannes-plenio-E-Zuyev2XWo-unsplash.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">fa_555's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a><a class="site-page" href="/">文章</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于</a><a class="site-page" href="/links">友链</a></span></div><div id="post-info"><div id="post-title">2020 Apr Records</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-04-01</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%8A%A8%E6%80%81/">动态</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">8.1k</span><span class="post-meta__separator">|</span><span>阅读时长: 41 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>菜鸡 fa_555 会把一些动态简要地记在这里。主要还是留给自己以后看的。</p>
<span id="more"></span>
<p><em>所有代码不保证包括无关紧要的部分</em></p>
<hr>
<h3 id="SCOI2007-k短路"><a href="#SCOI2007-k短路" class="headerlink" title="[SCOI2007]k短路"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4467">[SCOI2007]k短路</a></h3><h4 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h4><p><del>这是一道卡 A* 的 A* 模板题</del></p>
<p>简单说一下 A* 算法。对于一个搜索状态，设计函数 $f, g, h, h^\ast$。其中 $g$ 为搜索到当前状态的代价；$h$ 为估计剩余的代价；$h^\ast$ 为实际剩余的代价，$h &lt; h^\ast$，且差距越小效率越高；$f = g + h$，对 $f$ 维护一个优先队列即可。</p>
<h4 id="code"><a href="#code" class="headerlink" title="code"></a>code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> N, K;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123; <span class="type">int</span> nxt, to, w; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> G1 &#123;</span><br><span class="line">  std::bitset&lt;51&gt; vis;</span><br><span class="line">  <span class="type">int</span> head[<span class="number">51</span>], dis[<span class="number">51</span>];</span><br><span class="line">  Edge e[<span class="number">2451</span>];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">spfa</span><span class="params">(<span class="type">int</span> s)</span></span>;</span><br><span class="line">&#125; <span class="comment">// G1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> G2 &#123;</span><br><span class="line">  <span class="type">int</span> *h = G1::dis, head[<span class="number">51</span>];</span><br><span class="line">  Edge e[<span class="number">2451</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    std::bitset&lt;51&gt; vis;</span><br><span class="line">    <span class="type">int</span> s, u, len, f;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; z;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Node &amp;rhs) <span class="type">const</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (f != rhs.f) <span class="keyword">return</span> f &gt; rhs.f;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, mx = std::<span class="built_in">min</span>(z.<span class="built_in">size</span>(), rhs.z.<span class="built_in">size</span>()); i &lt; mx; ++i)</span><br><span class="line">        <span class="keyword">if</span> (z[i] != rhs.z[i]) <span class="keyword">return</span> z[i] &gt; rhs.z[i];</span><br><span class="line">      <span class="keyword">return</span> z.<span class="built_in">size</span>() &gt; rhs.z.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> w)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Astar</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    std::priority_queue&lt;Node&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(&#123;std::<span class="built_in">bitset</span>&lt;<span class="number">51</span>&gt;(<span class="number">1ll</span> &lt;&lt; s), s, s, <span class="number">0</span>, h[s], std::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;()&#125;);</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Node now, nxt; q.<span class="built_in">size</span>(); ) &#123;</span><br><span class="line">      now = q.<span class="built_in">top</span>(), q.<span class="built_in">pop</span>();</span><br><span class="line">      <span class="keyword">if</span> (now.u == t &amp;&amp; ++cnt == K) &#123;</span><br><span class="line">        cout &lt;&lt; now.s;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> u : now.z)</span><br><span class="line">          cout &lt;&lt; -u;</span><br><span class="line">        cout.<span class="built_in">flush</span>();</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = head[now.u], v; i; i = e[i].nxt) &#123;</span><br><span class="line">        <span class="keyword">if</span> (now.vis[v = e[i].to]) <span class="keyword">continue</span>;</span><br><span class="line">        nxt = &#123;now.vis, now.s, v, now.len + e[i].w, h[v], now.z&#125;;</span><br><span class="line">        nxt.vis.<span class="built_in">set</span>(v), nxt.z.<span class="built_in">push_back</span>(v), nxt.f += nxt.len;</span><br><span class="line">        q.<span class="built_in">push</span>(nxt);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="comment">// G2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> M, S, T;</span><br><span class="line"></span><br><span class="line">  cin &gt;&gt; N &gt;&gt; M &gt;&gt; K &gt;&gt; S &gt;&gt; T;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> u, v, w; M; --M) &#123;</span><br><span class="line">    cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;</span><br><span class="line">    G1::<span class="built_in">addEdge</span>(v, u, w), G2::<span class="built_in">addEdge</span>(u, v, w);</span><br><span class="line">  &#125;</span><br><span class="line">  G1::<span class="built_in">spfa</span>(T), G2::<span class="built_in">Astar</span>(S, T);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="NOI2005-智慧珠游戏"><a href="#NOI2005-智慧珠游戏" class="headerlink" title="[NOI2005]智慧珠游戏"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4205">[NOI2005]智慧珠游戏</a></h3><p>DLX 是之前学的，这里记一记怎么建出一个精确覆盖模型。</p>
<ol>
<li><p>对整个拼盘按照一定的方法编号，每个格子对应一个号码（下面的代码采用先从左到右，再从上到下依次编号）。</p>
</li>
<li><p>把所有零件的形状存下来。这里采取的是确定一个关键点，其余点用相对坐标表示的方法。</p>
</li>
<li><p>设一个有若干行、每行 67 列的 01 矩阵，每行表示某个零件的一种摆法。其中左 12 列表示 12 个零件种类（第 $i$ 列为 $1$ 表示该行代表第 $i$ 种零件的某种摆法）；右 55 列表示拼盘上的 55 个空位，第 $i$ 列为 $1$ 表示这种摆法占据了第 $i$ 个格子。</p>
</li>
<li><p>对于 <strong>12 种</strong>零件分别枚举摆法。</p>
<ul>
<li><p>首先枚举上文提到的“关键点”的坐标，一共 <strong>55​ 种</strong>情况。</p>
</li>
<li><p>然后要枚举它的旋转、翻转变换。然而旋转操作并不方便编程直接实现，要考虑怎么实现。画一画图发现一共有 <strong>8 种</strong>不同摆法（如图）</p>
</li>
<li><p><img src="/files/img/P4205_1.png" alt="我是图"></p>
</li>
<li><p>发现可以通过三种简单的变换得到：交换横纵坐标、横坐标取相反数、纵坐标取相反数。</p>
</li>
</ul>
</li>
<li><p>把枚举出来的所有状态全扔进一个矩阵，DLX 跑个精确覆盖，完事了。统计答案有很多种方法，可以各路神仙八仙过海一下（</p>
</li>
<li><p>对于全空拼盘，理论上矩阵最大行数 $12 \times 55 \times 8 = 5280$，实际上由于零件形状的制约只有 <strong>2730 种</strong>，矩阵中的 $1$ 最多 <strong>15083​ 个</strong>。</p>
</li>
</ol>
<h4 id="code-1"><a href="#code-1" class="headerlink" title="code"></a>code</h4><p>对于上面的三种变换，这里通过状态 $S \in [0, 8)$ 来枚举，$S$ 的最低三位从高到低依次表示是否交换横纵坐标、横坐标是否相反数、纵坐标是否取相反数。</p>
<p>部分变量解释：</p>
<ul>
<li><p><code>siz[i]</code> 表示第 $i$ 种零件的珠子个数</p>
</li>
<li><p><code>sh[i][][]</code> 表示第 $i$ 种零件的形状（见上文）</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> siz[] = &#123;</span><br><span class="line">  <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span></span><br><span class="line">&#125;, sh[<span class="number">13</span>][<span class="number">5</span>][<span class="number">2</span>] = &#123;&#123;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">0</span>, <span class="number">2</span>&#125;, &#123;<span class="number">0</span>, <span class="number">3</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">0</span>, <span class="number">2</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">0</span>, <span class="number">2</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">0</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">1</span>&#125;, &#123;<span class="number">3</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">2</span>&#125;, &#123;<span class="number">2</span>, <span class="number">2</span>&#125;&#125;,</span><br><span class="line">  &#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">2</span>, <span class="number">0</span>&#125;, &#123;<span class="number">3</span>, <span class="number">0</span>&#125;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Data = std::vector&lt;std::pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt;;</span><br><span class="line"></span><br><span class="line">std::bitset&lt;13&gt; used;</span><br><span class="line"><span class="type">char</span> z[<span class="number">13</span>][<span class="number">13</span>];</span><br><span class="line">Data v[<span class="number">13</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> DLX &#123;</span><br><span class="line">  <span class="keyword">using</span> iarr = <span class="type">int</span>[<span class="number">15085</span>];</span><br><span class="line"></span><br><span class="line">  std::bitset&lt;69&gt; mp[<span class="number">2733</span>];</span><br><span class="line">  <span class="type">int</span> tot, ans[<span class="number">15</span>], cnt[<span class="number">69</span>], h[<span class="number">2733</span>];</span><br><span class="line">  iarr l, r, u, d, x, y;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> M)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> R, <span class="type">int</span> C)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> C)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">resume</span><span class="params">(<span class="type">int</span> C)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">dance</span><span class="params">(<span class="type">int</span> dep)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!r[<span class="number">0</span>]) &#123;</span><br><span class="line">      <span class="comment">/* output */</span></span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="comment">// DLX</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">pos</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> to[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">28</span>, <span class="number">36</span>, <span class="number">45</span>, <span class="number">55</span>&#125;;</span><br><span class="line">  <span class="keyword">return</span> to[i - <span class="number">1</span>] + j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> c, <span class="type">const</span> Data &amp;v)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// v 中的元素为颜色 c 某种状态占据的坐标</span></span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> M = <span class="number">0</span>;</span><br><span class="line">  DLX::<span class="built_in">link</span>(++M, c);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;x : v)</span><br><span class="line">    DLX::<span class="built_in">link</span>(M, <span class="number">12</span> + <span class="built_in">pos</span>(x.first, x.second));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">valid</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> &lt;= x &amp;&amp; x &lt;= <span class="number">10</span> &amp;&amp; <span class="number">1</span> &lt;= y &amp;&amp; y &lt;= x &amp;&amp; z[x][y] == <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; ++i)</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= i; ++j) &#123;</span><br><span class="line">      std::cin &gt;&gt; z[i][j];</span><br><span class="line">      <span class="keyword">if</span> (z[i][j] != <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line">        used.<span class="built_in">set</span>(z[i][j] &amp; <span class="number">31</span>);</span><br><span class="line">        v[z[i][j] &amp; <span class="number">31</span>].<span class="built_in">push_back</span>(&#123;i, j&#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  DLX::<span class="built_in">init</span>(<span class="number">67</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">12</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (used[i]) &#123;</span><br><span class="line">      <span class="built_in">insert</span>(i, v[i]);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v[i].<span class="built_in">resize</span>(siz[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> pi = <span class="number">1</span>; pi &lt;= <span class="number">10</span>; ++pi)</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> pj = <span class="number">1</span>; pj &lt;= pi; ++pj)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> S = <span class="number">0</span>; S &lt; <span class="number">8</span>; ++S) &#123;</span><br><span class="line">          <span class="type">bool</span> g = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>, nx, ny; j &lt; siz[i]; ++j) &#123;</span><br><span class="line">            nx = sh[i][j][<span class="number">0</span>], ny = sh[i][j][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (S &amp; <span class="number">4</span>) std::<span class="built_in">swap</span>(nx, ny);</span><br><span class="line">            <span class="keyword">if</span> (S &amp; <span class="number">2</span>) nx = -nx;</span><br><span class="line">            <span class="keyword">if</span> (S &amp; <span class="number">1</span>) ny = -ny;</span><br><span class="line">            nx += pi, ny += pj;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">valid</span>(nx, ny)) &#123; g = <span class="number">1</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">            v[i][j] = &#123;nx, ny&#125;;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!g) <span class="built_in">insert</span>(i, v[i]);</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  DLX::<span class="built_in">dance</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;No solution&quot;</span>); <span class="comment">// 有解的情况在 DLX 中直接退出</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="数学"><a href="#数学" class="headerlink" title="数学"></a>数学</h3><p>在 CSG 那里学习了一个。</p>
<p>本来想搞多项式，结果被数论水平限制了，去从零重学数论，没想到一学就是好长好长好长时间 /kk</p>
<p><a target="_blank" rel="noopener" href="https://fa555.github.io/2020/%E6%9D%9C%E6%95%99%E7%AD%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习杜教筛</a></p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4450">双亲数</a>发现了自己以前题解的错误并<a target="_blank" rel="noopener" href="https://fa555.github.io/2019/%E9%A2%98%E8%A7%A3-P4450-%E3%80%90%E5%8F%8C%E4%BA%B2%E6%95%B0%E3%80%91/">重写</a></p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5170">类欧几里得算法</a>花两天边颓边<a target="_blank" rel="noopener" href="https://fa555.github.io/2020/%E7%B1%BB%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95%E6%8A%84%E5%BC%8F%E5%AD%90%E7%AC%94%E8%AE%B0/">抄了一遍式子</a>又花一天写出来代码，<del>因为懒</del><a target="_blank" rel="noopener" href="https://fa555.github.io/2020/cpp%E4%B8%8D%E5%AE%9A%E5%8F%82%E5%87%BD%E6%95%B0%E5%88%9D%E6%8E%A2//">研究了各种不定参的写法</a>。</p>
<hr>
<h3 id="BSGS"><a href="#BSGS" class="headerlink" title="BSGS"></a>BSGS</h3><p>学了 BSGS 和 exBSGS。<del>好难啊直接背吧</del></p>
<p>内附一个 Hash 表板子，机制类似于 <code>std::unordered_map</code> 但是跑得快（</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> Hmod = <span class="number">1000003</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Hash</span> &#123;</span><br><span class="line">  std::bitset&lt;Hmod&gt; vis;</span><br><span class="line">  <span class="type">int</span> tv[Hmod], tp[Hmod];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vis.<span class="built_in">reset</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = p % Hmod;</span><br><span class="line">    <span class="keyword">for</span> (; vis[k]; ++k %= Hmod)</span><br><span class="line">      <span class="keyword">if</span> (tp[k] == p) &#123;</span><br><span class="line">        tv[k] = v;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    vis.<span class="built_in">set</span>(k), tv[k] = v, tp[k] = p;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = p % Hmod; vis[k]; ++k %= Hmod)</span><br><span class="line">      <span class="keyword">if</span> (tp[k] == p) <span class="keyword">return</span> tv[k];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; z;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">BSGS</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> p, <span class="type">int</span> sd)</span> </span>&#123;</span><br><span class="line">  z.<span class="built_in">clear</span>();</span><br><span class="line">  <span class="type">int</span> v = <span class="number">1</span>, t = <span class="built_in">ceil</span>(<span class="built_in">sqrt</span>(p));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; t; ++i, v = <span class="number">1ll</span> * v * a % p)</span><br><span class="line">    z.<span class="built_in">insert</span>(<span class="number">1ll</span> * v * b % p, i);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j, v_ = v, v = sd; i &lt;= t; ++i, v = <span class="number">1ll</span> * v * v_ % p)</span><br><span class="line">    <span class="keyword">if</span> ((j = z.<span class="built_in">query</span>(v)) != <span class="number">-1</span> &amp;&amp; i * t &gt;= j) <span class="keyword">return</span> i * t - j;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exBSGS</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">  a %= p, b %= p;</span><br><span class="line">  <span class="keyword">if</span> (b == <span class="number">1</span> || p == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> cnt = <span class="number">0</span>, sd = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> d; (d = std::__gcd(a, p)) != <span class="number">1</span>; ) &#123;</span><br><span class="line">    <span class="keyword">if</span> (b % d) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    ++cnt, b /= d, p /= d;</span><br><span class="line">    sd = <span class="number">1ll</span> * sd * a / d % p;</span><br><span class="line">    <span class="keyword">if</span> (sd == b) <span class="keyword">return</span> cnt;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> ans = <span class="built_in">BSGS</span>(a, b, p, sd);</span><br><span class="line">  <span class="keyword">if</span> (ans != <span class="number">-1</span>) ans += cnt;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="原根"><a href="#原根" class="headerlink" title="原根"></a>原根</h3><p>关于原根的笔记<a target="_blank" rel="noopener" href="https://fa555.github.io/2020/%E5%8E%9F%E6%A0%B9%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">在这里</a></p>
<hr>
<h3 id="SDOI2010-古代猪文"><a href="#SDOI2010-古代猪文" class="headerlink" title="[SDOI2010]古代猪文"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problemnew/solution/P2480">[SDOI2010]古代猪文</a></h3><h4 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h4><p>给定正整数 $n, g \ (n, g \le 10^9)$，求 $g^{ \sum_{d \mid n}{ \binom nd}} \bmod 999911659$。</p>
<h4 id="solution-1"><a href="#solution-1" class="headerlink" title="solution"></a>solution</h4><p>本能考虑欧拉定理，则答案等于 $g^{ \sum_{d \mid n}{ \binom nd} \bmod 999911658} \bmod 999911659$。</p>
<p>设 $x = \sum_{d \mid n}{ \binom nd} \bmod 999911658$，重点在于求出 $x$。怎么求呢？</p>
<h5 id="Extended-Lucas"><a href="#Extended-Lucas" class="headerlink" title="Extended Lucas"></a>Extended Lucas</h5><p>这个指数可以直接无脑上 Extended Lucas 嘛对不对（</p>
<p>这个复杂度上天的做法在 LOJ 是最劣解第一，在谷直接 TLE 成了 70 分（</p>
<h5 id="Lucas-CRT"><a href="#Lucas-CRT" class="headerlink" title="Lucas + CRT"></a>Lucas + CRT</h5><p>考虑对模数进行质因数分解，$999911658 = 2 \times 3 \times 4679 \times 35617$。发现四个因子都是质数而不是质数的幂，因此可以使用 Lucas 计算出</p>
<script type="math/tex; mode=display">
\begin{cases}
x \equiv r_1 \pmod 2 \\
x \equiv r_2 \pmod 3 \\
x \equiv r_3 \pmod{4679} \\
x \equiv r_4 \pmod{35617}
\end{cases}</script><p>中的 $r_1, r_2, r_3, r_4$，再使用 CRT 合并得到 $x$。</p>
<h4 id="code-2"><a href="#code-2" class="headerlink" title="code"></a>code</h4><p>这个做法我的实现在 LOJ 得到了最优解第二。<del>如果我早交 11 个小时就能当第一</del></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> m[<span class="number">5</span>] = &#123;<span class="number">999911659</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4679</span>, <span class="number">35617</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> r[<span class="number">5</span>], fac[<span class="number">5</span>][<span class="number">35619</span>], invF[<span class="number">5</span>][<span class="number">35619</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Pow</span><span class="params">(ll b, ll p, ll m)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prework</span><span class="params">()</span></span>; <span class="comment">// 在 fac[k][i] 和 invF[k][i] 中求出模 m[k] 意义下 i 的阶乘及其逆元</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">C</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> M, <span class="type">int</span> k)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Lucas</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> M, <span class="type">int</span> k)</span></span>; <span class="comment">// 求 C(N, M) % m[k]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= <span class="number">4</span>; ++k)</span><br><span class="line">    r[k] = (r[k] + <span class="built_in">Lucas</span>(N, i, k)) % m[k];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CRT</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> *r, <span class="type">const</span> <span class="type">int</span> *m)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">int</span> p = *m - <span class="number">1</span>;</span><br><span class="line">  <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= N; ++k)</span><br><span class="line">    ans = (ans + <span class="number">1ll</span> * r[k] * (p / m[k]) % p * <span class="built_in">Pow</span>(p / m[k], m[k] - <span class="number">2</span>, m[k]) % p) % p;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> g)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (g % *m == <span class="number">0</span>) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">prework</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i * i &lt;= N; ++i)</span><br><span class="line">    <span class="keyword">if</span> (N % i == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">calc</span>(N, i);</span><br><span class="line">      <span class="keyword">if</span> (i * i != N) <span class="built_in">calc</span>(N, N / i);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Pow</span>(g, <span class="built_in">CRT</span>(<span class="number">4</span>, r, m), *m);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="HAOI2011-Problem-b"><a href="#HAOI2011-Problem-b" class="headerlink" title="[HAOI2011]Problem b"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2522">[HAOI2011]Problem b</a></h3><h4 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h4><p>$T \ (1 \le T \le 5 \times 10^4)$ 组数据，给定 $a, b, c, d, k \ (1 \le a, b, c, d, k \le 5 \times 10^4)$，求 $\sum<em>{i = a}^b{ \sum</em>{j = c}^d{[\gcd(i, j) = k]}}$。</p>
<h4 id="solution-2"><a href="#solution-2" class="headerlink" title="solution"></a>solution</h4><p>我以前写过<a target="_blank" rel="noopener" href="https://www.luogu.org/problem/P4450">这道题</a>的<a target="_blank" rel="noopener" href="https://fa555.github.io/2019/%E9%A2%98%E8%A7%A3-P4450-%E3%80%90%E5%8F%8C%E4%BA%B2%E6%95%B0%E3%80%91/">题解</a>对吧（</p>
<p>一模一样，套个傻逼容斥就完了，总复杂度 $O(n + T \sqrt n)$，带一个不小的常数。</p>
<hr>
<h3 id="LCMSUM"><a href="#LCMSUM" class="headerlink" title="LCMSUM"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP5971">LCMSUM</a></h3><h4 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h4><p>$T \ (1 \le T \le 3 \times 10^5)$ 组数据，给定 $n \ (1 \le n \le 10^6)$，求 $\sum_{i = 0}^n{ \mathrm{lcm}(i, n)}$。</p>
<h4 id="solution-3"><a href="#solution-3" class="headerlink" title="solution"></a>solution</h4><p>设 $d’ = n / d$，则</p>
<script type="math/tex; mode=display">
\begin{align}
\sum_{i = 0}^n{ \mathrm{lcm}(i, n)} &= \sum_{i = 1}^n \frac{in}{ \gcd(i, n)} \\
&= \frac 12 \left( \sum_{i = 1}^{n - 1}{ \frac{in}{ \gcd(i, n)} + \sum_{i = n - 1}^1{ \frac{in}{ \gcd(i, n)}}} \right) + n \\
&= \frac 12 \left( \sum_{i = 1}^{n - 1}{ \frac{in}{ \gcd(i, n)} + \sum_{i = n - 1}^1{ \frac{in}{ \gcd(n - i, n)}}} \right) + n \\
&= \frac 12 \sum_{i = 1}^{n - 1}{ \frac{n^2}{ \gcd(i, n)}} + n \\
&= \frac 12 \sum_{i = 1}^n{ \frac{n^2}{ \gcd(i, n)}} + \frac n2 \\
&= \frac 12 \sum_{d \mid n}{\frac{n^2 \varphi(d')}d} + \frac n2 \\
&= \frac n2 \left( \sum_{d \mid n}{d' \varphi(d') + 1} \right)
\end{align}</script><p>设 $f(n) = \sum_{d \mid n} d \ \varphi(d)$。</p>
<p>$f$ 是积性函数，可以 $O(n) - O(1)$，总复杂度 $O(n + T)$。$O(n)$ 筛这个函数的操作好像很骚的样子，不过也有 $O(n \log n)$ 的用 $\varphi$ 间接求的算法。</p>
<h4 id="code-3"><a href="#code-3" class="headerlink" title="code"></a>code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">std::bitset&lt;1000003&gt; v;</span><br><span class="line"><span class="type">int</span> p[<span class="number">78501</span>];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> f[<span class="number">1000003</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> sieve = ([]() &#123;</span><br><span class="line">  <span class="keyword">constexpr</span> <span class="type">int</span> N = <span class="number">1000000</span>;</span><br><span class="line">  <span class="type">int</span> M = <span class="number">0</span>;</span><br><span class="line">  v.<span class="built_in">set</span>(<span class="number">1</span>), f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!v[i]) p[++M] = i, f[i] = <span class="number">1ll</span> * i * (i - <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= M &amp;&amp; i * p[j] &lt;= N; ++j) &#123;</span><br><span class="line">      v.<span class="built_in">set</span>(i * p[j]);</span><br><span class="line">      <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i / p[j] % p[j] == <span class="number">0</span>)</span><br><span class="line">          f[i * p[j]] = f[i] + (f[i] - f[i / p[j]]) * p[j] * p[j];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          f[i * p[j]] = f[i] + f[i / p[j]] * (p[j] - <span class="number">1</span>) * p[j] * p[j] * p[j];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      f[i * p[j]] = f[i] * f[p[j]];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (f[N] * N + N) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Crash的数字表格"><a href="#Crash的数字表格" class="headerlink" title="Crash的数字表格"></a><a target="_blank" rel="noopener" href="https://www.luogu.org/problem/P1829">Crash的数字表格</a></h3><h4 id="problem-3"><a href="#problem-3" class="headerlink" title="problem"></a>problem</h4><p>给定 $n, m \ (1 \le n, m, \le 10^7)$，求 $\sum<em>{i = 1}^n{ \sum</em>{j = 1}^m{ \mathrm{lcm}(i, j)}}$ 在模意义下的值。</p>
<h4 id="solution-4"><a href="#solution-4" class="headerlink" title="solution"></a>solution</h4><p>不妨设 $n \le m$。</p>
<script type="math/tex; mode=display">
\begin{align}
\sum_{i = 1}^n{ \sum_{j = 1}^m{ \mathrm{lcm}(i, j)}} &= \sum_{i = 1}^n{ \sum_{j = 1}^m{ \frac{ij}{ \gcd(i, j)}}} \\
&= \sum_{i = 1}^n{ \sum_{j = 1}^m{ \sum_{d \mid \gcd(i, j), \left[ \frac id \perp \frac jd \right]}{ \frac{ij}d}}} \\
&= \sum_{d = 1}^n{d \sum_{i = 1}^{ \lfloor n / d \rfloor}{ \sum_{j = 1}^{ \lfloor m / d \rfloor}{[i \perp j] \ ij}}}
\end{align}</script><p>令 $S(n, m) = \sum<em>{i = 1}^n{ \sum</em>{j = 1}^m{[i \perp j] \ ij}}$，则</p>
<script type="math/tex; mode=display">
\begin{align}
S(n, m) &= \sum_{i = 1}^n{ \sum_{j = 1}^m{ \epsilon( \gcd(i, j)) ij}} \\
&= \sum_{d = 1}^n{ \sum_{d \mid i}^n{ \sum_{d \mid j}^m{ \mu(d)ij}}} \\
&= \sum_{d = 1}^n{ \mu(d)d^2 \sum_{i = 1}^{n / d}{ \sum_{j = 1}^{m / d}{ij}}}
\end{align}</script><p>令 $f(n, m) = \sum<em>{i = 1}^n{ \sum</em>{j = 1}^m ij} = \frac{n(n + 1)}2 \times \frac{m(m + 1)}2$，则</p>
<script type="math/tex; mode=display">
S(n, m) = \sum_{d = 1}^n{ \mu(d) · d^2 · f \left( \left\lfloor \frac nd \right\rfloor, \left\lfloor \frac md \right\rfloor \right)}</script><p>可以数论分块 $O \left( \left\lfloor \frac{n}{ \lfloor n / d \rfloor} \right\rfloor \right)$ 求 $S(n, m)$。则原答案为</p>
<script type="math/tex; mode=display">
\sum_{d = 1}^n{d · S \left( \left\lfloor \frac nd \right\rfloor, \left\lfloor \frac md \right\rfloor \right)}</script><hr>
<h4 id="code-4"><a href="#code-4" class="headerlink" title="code"></a>code</h4><p>注意代码中有两处 <code>assert</code>，改变其数量，在评测鸭实测速度 2 &gt; 0 &gt; 1，不知为何。<del>可能是玄学</del></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> mod = <span class="number">20101009</span>;</span><br><span class="line"></span><br><span class="line">std::bitset&lt;10000003&gt; v;</span><br><span class="line"><span class="type">int</span> p[<span class="number">664581</span>], mu[<span class="number">10000003</span>], g[<span class="number">10000003</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sieve</span><span class="params">(<span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* 筛出 mu[1..N] */</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">    g[i] = (g[i - <span class="number">1</span>] + <span class="number">1ll</span> * i * i % mod * (mu[i] + mod) % mod) % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> M)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="number">1ll</span> * N * (N + <span class="number">1</span>) / <span class="number">2</span> % mod) * (<span class="number">1ll</span> * M * (M + <span class="number">1</span>) / <span class="number">2</span> % mod) % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">S</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> M)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">assert</span>(N &lt;= M);</span><br><span class="line">  <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r, n, m; l &lt;= N; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">    n = N / l, m = M / l;</span><br><span class="line">    r = std::<span class="built_in">min</span>(N / n, M / m);</span><br><span class="line">    ans = (ans + <span class="number">1ll</span> * (g[r] - g[l - <span class="number">1</span>] + mod) * <span class="built_in">f</span>(n, m) % mod) % mod;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> M)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">assert</span>(N &lt;= M);</span><br><span class="line">  <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r, n, m; l &lt;= N; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">    n = N / l, m = M / l;</span><br><span class="line">    r = std::<span class="built_in">min</span>(N / n, M / m);</span><br><span class="line">    ans = (ans + <span class="number">1ll</span> * (r - l + <span class="number">1</span>) * (l + r) / <span class="number">2</span> % mod * <span class="built_in">S</span>(n, m) % mod) % mod;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> N, M;</span><br><span class="line"></span><br><span class="line">  std::cin &gt;&gt; N &gt;&gt; M;</span><br><span class="line">  <span class="keyword">if</span> (N &gt; M) std::<span class="built_in">swap</span>(N, M);</span><br><span class="line">  <span class="built_in">sieve</span>(N);</span><br><span class="line">  std::cout &lt;&lt; <span class="built_in">solve</span>(N, M);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="SDOI2015约数个数和"><a href="#SDOI2015约数个数和" class="headerlink" title="[SDOI2015约数个数和]"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3327">[SDOI2015约数个数和]</a></h3><h4 id="problem-4"><a href="#problem-4" class="headerlink" title="problem"></a>problem</h4><p>$T \ (1 \le T \le 50000)$ 组数据，给定 $n, m \ (1 \le n, m \le 50000)$，求 $\sum<em>{i = 1}^n{ \sum</em>{j = 1}^m{ \mathrm d(ij)}}$。其中 $\mathrm d$ 为约数个数函数。</p>
<h4 id="solution-5"><a href="#solution-5" class="headerlink" title="solution"></a>solution</h4><p>首先有个很少人会证的结论</p>
<script type="math/tex; mode=display">
\mathrm d(ij) = \sum_{x \mid i}{ \sum_{y \mid j}{[x \perp y]}}</script><p>然后可以通过一系列简单的操作得到答案为（设 $n \le m$）</p>
<script type="math/tex; mode=display">
\sum_{d = 1}^n{ \mu(d) · S_\mathrm d \left( \left\lfloor \frac nd \right\rfloor \right) · S_\mathrm d \left( \left\lfloor \frac md \right\rfloor \right)}</script><p>其中 $S_\mathrm d$ 为 $\mathrm d$ 的前缀和函数。外层显然数论分块，总复杂度是 $O(n + T \sqrt n)$。</p>
<hr>
<h3 id="ZJOI2014-力"><a href="#ZJOI2014-力" class="headerlink" title="[ZJOI2014]力"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3338">[ZJOI2014]力</a></h3><h4 id="problem-5"><a href="#problem-5" class="headerlink" title="problem"></a>problem</h4><p>给出 $n \ (1 \le n \le 10^5)$ 个数 $q_i \ (1 \le q_i &lt; 10^9)$，定义</p>
<script type="math/tex; mode=display">
F_i = \sum_{j = 1}^{i - 1}{\frac{q_i q_j}{(i - j)^2}} - \sum_{j = i + 1}^n \frac{q_i q_j}{(i - j)^2} \\
E_i = \frac{F_i}{q_i}</script><p>求 $E_{1 \dots n}$。</p>
<h4 id="solution-6"><a href="#solution-6" class="headerlink" title="solution"></a>solution</h4><script type="math/tex; mode=display">
E_i = \frac{F_i}{q_i} = \sum_{j = 1}^{i - 1}{\frac{q_j}{(i - j)^2}} - \sum_{j = i + 1}^n \frac{q_j}{(i - j)^2}</script><p>令</p>
<script type="math/tex; mode=display">
f_i = \begin{cases}
0 & , i = 0 \\
q_i & , i > 0
\end{cases}, \quad 
g_i = \begin{cases}
0 & , i = 0 \\
\frac 1{i^2} & , i > 0
\end{cases}</script><p>则</p>
<script type="math/tex; mode=display">
\begin{align}
E_i &= \sum_{j = 0}^{i}{f_j g_{i - j}} - \sum_{j = i}^n{f_j g_{j - i}} \\
&= \sum_{j = 0}^{i}{f_j g_{i - j}} - \sum_{j = 0}^{n - i}{f_{i + j} g_{j}}
\end{align}</script><p>令 $f’<em>i = f</em>{n - i}, t = n - i$，则</p>
<script type="math/tex; mode=display">
E_i = \sum_{j = 0}^{i}{f_j g_{i - j}} - \sum_{j = 0}^t{f'_{t - j} g_{j}}</script><p>式子推完了，开始整多项式。令（注意此处 $F$ 与题目给出的 $F$ 不同）</p>
<script type="math/tex; mode=display">
\begin{align}
A(x) &= \sum_{i = 0}^n{f_i x^i} \\
B(x) &= \sum_{i = 0}^n{f'_i x^i} \\
C(x) &= \sum_{i = 0}^n{g_i x^i} \\
F(x) &= A(x) \ast C(x) \\
G(x) &= B(x) \ast C(x) \\
E_i &= F_i - G_{n - i}
\end{align}</script><h4 id="code-5"><a href="#code-5" class="headerlink" title="code"></a>code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> ans[<span class="number">50003</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span>* <span class="title">solve</span><span class="params">(<span class="type">int</span> N, <span class="type">double</span> *p)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> lim, l;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (lim = <span class="number">1</span>, l = <span class="number">-1</span>; lim &lt;= N &lt;&lt; <span class="number">1</span>; lim &lt;&lt;= <span class="number">1</span>, ++l);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    to[i] = (to[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; l);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">    A[i].x = B[N - i].x = p[i];</span><br><span class="line">    C[i].x = <span class="number">1.</span> / (<span class="number">1.</span> * i * i);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">FFT</span>(lim, A, <span class="number">1</span>), <span class="built_in">FFT</span>(lim, B, <span class="number">1</span>), <span class="built_in">FFT</span>(lim, C, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    A[i] = A[i] * C[i], B[i] = B[i] * C[i];</span><br><span class="line">  <span class="built_in">FFT</span>(lim, A, <span class="number">-1</span>), <span class="built_in">FFT</span>(lim, B, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">    ans[i] = A[i].x - B[N - i].x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="AHOI2017-HNOI2017-礼物"><a href="#AHOI2017-HNOI2017-礼物" class="headerlink" title="[AHOI2017/HNOI2017]礼物"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3723">[AHOI2017/HNOI2017]礼物</a></h3><h4 id="solution-7"><a href="#solution-7" class="headerlink" title="solution"></a>solution</h4><p>枚举对第一个手环整体加 $c \ (-m &lt; c &lt; m)$，那么两个手环之间的差异值为</p>
<script type="math/tex; mode=display">
\begin{align}
& \sum_{i = 1}^n{(a_i + c - b_i)^2} \\
=& \sum_{i = 1}^n{(a_i^2 + b_i^2 + c^2 + 2 a_i c - 2 b_i c - 2 a_i b_i)} \\
=& \sum_{i = 1}^n{(a_i^2 + b_i^2)} + 2 c \sum_{i = 1}^n{(a_i - b_i)} - 2 \sum_{i = 1}^n{a_i b_i} + nc^2
\end{align}</script><p>发现除了最后一项以外都是确定的。那么只要令 $\sum_{i = 1}^n{a_i b_i}$ 最大就可以得到最小值了。</p>
<p>首先把 $a$ 序列反向一下，得到 $\sum<em>{i = 1}^n{a</em>{n - i + 1}^n b_i}$，然后在反向后的 $a$ 倍长破环成链，与 $b$ 卷起来得到的新多项式的第 $n + 1\sim 2n$ 项中找最大值即可。</p>
<h4 id="code-6"><a href="#code-6" class="headerlink" title="code"></a>code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> *a, <span class="type">int</span> M, <span class="type">int</span> *b)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> lim, l, ans = <span class="number">0x3f3f3f3f</span>, ans1 = <span class="number">0</span>, ans2 = <span class="number">0</span>, ans3 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (lim = <span class="number">1</span>, l = <span class="number">-1</span>; lim &lt;= N * <span class="number">3</span>; lim &lt;&lt;= <span class="number">1</span>, ++l);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    to[i] = (to[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; l);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, t; i &lt; N; ++i) &#123;</span><br><span class="line">    t = a[i + <span class="number">1</span>];</span><br><span class="line">    A[N - i].x = A[(N &lt;&lt; <span class="number">1</span>) - i].x = t;</span><br><span class="line">    ans1 += t * t, ans2 += t &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, t; i &lt;= N; ++i) &#123;</span><br><span class="line">    t = b[i];</span><br><span class="line">    B[i].x = t;</span><br><span class="line">    ans1 += t * t, ans2 -= t &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">FFT</span>(lim, A, <span class="number">1</span>), <span class="built_in">FFT</span>(lim, B, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    A[i] = A[i] * B[i];</span><br><span class="line">  <span class="built_in">FFT</span>(lim, A, <span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = N + <span class="number">1</span>; i &lt;= N &lt;&lt; <span class="number">1</span>; ++i)</span><br><span class="line">    ans3 = std::<span class="built_in">max</span>(ans3, <span class="built_in">int</span>(A[i].x + <span class="number">0.5</span>));</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = -M; i &lt;= M; ++i)</span><br><span class="line">    ans = std::<span class="built_in">min</span>(ans, i * ans2 + N * i * i);</span><br><span class="line">  ans += ans1 - (ans3 &lt;&lt; <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="SP4882-DAGCNT2-Counting-in-a-DAG"><a href="#SP4882-DAGCNT2-Counting-in-a-DAG" class="headerlink" title="SP4882 DAGCNT2 - Counting in a DAG"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/jump/spoj/4882">SP4882 DAGCNT2 - Counting in a DAG</a></h3><h4 id="problem-6"><a href="#problem-6" class="headerlink" title="problem"></a>problem</h4><p>$T \ (1 \le T \le 2)$ 组数据，给定 $n \ (1 \le n \le 2 \times 10^4)$ 个点 $m \ (1 \le m \le 5 \times 10^5)$ 条边的 DAG，点带权，求每个点出发所能到达的点的点权和。</p>
<h4 id="solution-8"><a href="#solution-8" class="headerlink" title="solution"></a>solution</h4><p>啊，这个问题的复杂度已经被证明下界是 $O(n^2)$ 的了（</p>
<p>我非常好奇怎么过这个数据范围，于是在网上找到一篇神仙状压的代码并抄了一遍（</p>
<h4 id="code-7"><a href="#code-7" class="headerlink" title="code"></a>code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> iarrN = <span class="type">int</span>[<span class="number">20003</span>];</span><br><span class="line"></span><br><span class="line">std::bitset&lt;20003&gt; vis;</span><br><span class="line"><span class="type">int</span> top, f[<span class="number">20003</span>][<span class="number">627</span>];</span><br><span class="line">iarrN mp, rmp, s, w, outd, ans;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; G[<span class="number">20003</span>], R[<span class="number">20003</span>], D[<span class="number">20003</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">  vis.<span class="built_in">reset</span>();</span><br><span class="line">  <span class="built_in">memset</span>(outd + <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>) * N);</span><br><span class="line">  <span class="built_in">memset</span>(ans + <span class="number">1</span>, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>) * N);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">    G[i].<span class="built_in">clear</span>(), R[i].<span class="built_in">clear</span>(), D[i].<span class="built_in">clear</span>();</span><br><span class="line">    <span class="built_in">memset</span>(f[i], <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>) * ((i &gt;&gt; <span class="number">5</span>) + <span class="number">1</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">  vis.<span class="built_in">set</span>(u);</span><br><span class="line">  f[u][u &gt;&gt; <span class="number">5</span>] |= <span class="number">1</span> &lt;&lt; (u &amp; <span class="number">31</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> v : D[u])</span><br><span class="line">    <span class="keyword">if</span> (!(f[u][v &gt;&gt; <span class="number">5</span>] &amp; (<span class="number">1</span> &lt;&lt; (v &amp; <span class="number">31</span>)))) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!vis[v]) <span class="built_in">dfs</span>(v);</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= v &gt;&gt; <span class="number">5</span>; ++j)</span><br><span class="line">        f[u][j] |= f[v][j];</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= u &gt;&gt; <span class="number">5</span>; ++j)</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i)</span><br><span class="line">      <span class="keyword">if</span> (f[u][j] &amp; (<span class="number">1</span> &lt;&lt; i))</span><br><span class="line">        ans[rmp[u]] += w[rmp[(j &lt;&lt; <span class="number">5</span>) + i]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> T, N, M;</span><br><span class="line"></span><br><span class="line">  cin &gt;&gt; T;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> _T = <span class="number">0</span>; _T &lt; T; ++_T) &#123;</span><br><span class="line">    cin &gt;&gt; N &gt;&gt; M;</span><br><span class="line">    <span class="keyword">if</span> (_T) <span class="built_in">init</span>(N);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">      cin &gt;&gt; w[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, u, v; i &lt;= M; ++i) &#123;</span><br><span class="line">      cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">      G[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">      R[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">      ++outd[u];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">      <span class="keyword">if</span> (!outd[i]) s[++top] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, u; top; ) &#123;</span><br><span class="line">      u = s[top--], mp[u] = i, rmp[i] = u, ++i;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> v : R[u])</span><br><span class="line">        <span class="keyword">if</span> (!--outd[v]) s[++top] = v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> u = <span class="number">1</span>; u &lt;= N; ++u)</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> v : G[u])</span><br><span class="line">        D[mp[u]].<span class="built_in">push_back</span>(mp[v]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">      std::<span class="built_in">sort</span>(D[i].<span class="built_in">rbegin</span>(), D[i].<span class="built_in">rend</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = N; i; --i)</span><br><span class="line">      <span class="keyword">if</span> (!vis[i]) <span class="built_in">dfs</span>(i);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">      cout &lt;&lt; ans[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="残缺的字符串"><a href="#残缺的字符串" class="headerlink" title="残缺的字符串"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4173">残缺的字符串</a></h3><h4 id="problem-7"><a href="#problem-7" class="headerlink" title="problem"></a>problem</h4><p>应该叫<strong>【模板】带通配符的单模式串匹配</strong>（</p>
<p>给定长为 $m$ 的模式串 $A$ 和长为 $n$ 的模式串 $B \ (1 \le m, n \le 3 \times 10^5)$。字符集小写字母和*，*可以匹配任意字符。</p>
<p>求 $B$ 串每个可以完全匹配 $A$ 串的位置。</p>
<h4 id="solution-单模式串匹配"><a href="#solution-单模式串匹配" class="headerlink" title="solution - 单模式串匹配"></a>solution - 单模式串匹配</h4><p>如果不带通配符，kmp 算法可以在 $O(n + m)$ 的时间内解决这个问题。对于带通配符的问题，我们使用多项式卷积来解决。</p>
<p>首先从不带通配符开始考虑。方便起见，字符串的下标均从 $0$ 开始。</p>
<p>定义完全匹配函数 $P(x) = \sum<em>{i = 0}^{m - 1}{(A_i - B</em>{x - m + i + 1})^2}$，其中平方是为了保证每一位的取值非负；那么若 $P(x) = 0$，则 $B_{x - m + 1 \dots x}$ 与 $A$ 完全匹配。为了制造卷积形式，把 $A$ 串翻转得到串 $S$，那么匹配函数</p>
<script type="math/tex; mode=display">
\begin{align}
P(x) &= \sum_{i = 0}^{m - 1}{(S_{m - i - 1} - B_{x - m + i + 1})^2} \\
&= \sum_{i = 0}^{m - 1}{S_{m - i - 1}^2} + \sum_{i = 0}^{m - 1}{B_{x - m + i + 1}^2} - 2 \sum_{i = 0}^{m - 1}{S_{m - i - 1} B_{x - m + i + 1}}
\end{align}</script><p>第一项可以 $O(m)$ 求得，第二项可以 $O(n)$ 预处理前缀和，需要求的只有第三项。发现第三项两个下标的和恰好等于 $x$，因此可以写成 $- 2 \sum_{i + j = x}{S_i B_j}$（想一想，为什么？）</p>
<p>设 $T = \sum<em>{i = 0}^{m - 1} S_i^2, f(x) = \sum</em>{i = 0}^x{B<em>i^2}, g(x) = \sum</em>{i + j = x}{S_i B_j}$，则有 $P(x) = T + f(x) - f(x - m) - 2 g(x)$。这个直接 FFT 一下就好了。</p>
<h4 id="solution-带通配符的单模式串匹配"><a href="#solution-带通配符的单模式串匹配" class="headerlink" title="solution - 带通配符的单模式串匹配"></a>solution - 带通配符的单模式串匹配</h4><p>由于出现了通配符，需要定义一个新的匹配函数。设通配符的数值为 0，定义完全匹配函数 $P(x) = \sum<em>{i = 0}^{m - 1}(A_i - B</em>{x - m + i + 1})^2 A<em>i B</em>{x - m + i + 1}$。把 $A$ 串翻转得到串 $S$，那么匹配函数</p>
<script type="math/tex; mode=display">
\begin{align}
P(x) &= \sum_{i = 0}^{m - 1}{(S_{m - i - 1} - B_{x - m + i + 1})^2 S_{m - i - 1} B_{x - m + i + 1}} \\
&= \sum_{i = 0}^{m - 1}{S_{m - i - 1}^3 B_{x - m + i + 1}} + \sum_{i = 0}^{m - 1}{S_{m - i - 1} B_{x - m + i + 1}^3} - 2 \sum_{i = 0}^{m - 1}{S_{m - i - 1}^2 B_{x - m + i + 1}^2}
\end{align}</script><p>发现所有的项的两个下标的和都为 $x$，则有</p>
<script type="math/tex; mode=display">
P(x) = \sum_{i + j = x}{S_i^3 B_j} + \sum_{i + j = x}{S_i B_j^3} - 2 \sum_{i + j = x}{S_i^2 B_j^2}</script><p>6 次 DFT 和 1 次 IDFT 即刻求出。</p>
<h4 id="code-8"><a href="#code-8" class="headerlink" title="code"></a>code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Complex F[<span class="number">1</span>&lt;&lt;<span class="number">20</span>|<span class="number">1</span>], G[<span class="number">1</span>&lt;&lt;<span class="number">20</span>|<span class="number">1</span>], P[<span class="number">1</span>&lt;&lt;<span class="number">20</span>|<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> A[<span class="number">1</span>&lt;&lt;<span class="number">20</span>|<span class="number">1</span>], B[<span class="number">1</span>&lt;&lt;<span class="number">20</span>|<span class="number">1</span>], to[<span class="number">1</span>&lt;&lt;<span class="number">20</span>|<span class="number">1</span>];</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">solve</span><span class="params">(<span class="type">int</span> M, <span class="type">char</span> *s1, <span class="type">int</span> N, <span class="type">char</span> *s2)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> lim, l, tot = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (lim = <span class="number">1</span>, l = <span class="number">-1</span>; lim &lt;= M + N; lim &lt;&lt;= <span class="number">1</span>, ++l);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    to[i] = (to[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; l);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; M; ++i)</span><br><span class="line">    A[M - i - <span class="number">1</span>] = s1[i] == <span class="string">&#x27;*&#x27;</span> ? <span class="number">0</span> : s1[i] &amp; <span class="number">31</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">    B[i] = s2[i] == <span class="string">&#x27;*&#x27;</span> ? <span class="number">0</span> : s2[i] &amp; <span class="number">31</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    F[i] = <span class="built_in">Complex</span>(A[i] * A[i] * A[i], <span class="number">0</span>), G[i] = <span class="built_in">Complex</span>(B[i], <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">FFT</span>(lim, F, <span class="number">1</span>), <span class="built_in">FFT</span>(lim, G, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    P[i] = P[i] + F[i] * G[i];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    F[i] = <span class="built_in">Complex</span>(A[i], <span class="number">0</span>), G[i] = <span class="built_in">Complex</span>(B[i] * B[i] * B[i], <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">FFT</span>(lim, F, <span class="number">1</span>), <span class="built_in">FFT</span>(lim, G, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    P[i] = P[i] + F[i] * G[i];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    F[i] = <span class="built_in">Complex</span>(A[i] * A[i], <span class="number">0</span>), G[i] = <span class="built_in">Complex</span>(B[i] * B[i], <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">FFT</span>(lim, F, <span class="number">1</span>), <span class="built_in">FFT</span>(lim, G, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    P[i] = P[i] - <span class="built_in">Complex</span>(<span class="number">2</span>, <span class="number">0</span>) * F[i] * G[i];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">FFT</span>(lim, P, <span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = M - <span class="number">1</span>; i &lt; N; ++i)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(P[i].x) &lt; eps) <span class="comment">// 本题 eps 取 1e-1 可过</span></span><br><span class="line">      ans.<span class="built_in">push_back</span>(i - M + <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="集训队作业2013-城市规划"><a href="#集训队作业2013-城市规划" class="headerlink" title="[集训队作业2013]城市规划"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4841">[集训队作业2013]城市规划</a></h3><h4 id="problem-8"><a href="#problem-8" class="headerlink" title="problem"></a>problem</h4><p>求 $n \ (1 \le n \le 130000)$ 个点的有标号简单无向连通图的个数，答案对 $1004535809$ 取模。</p>
<h4 id="solution-9"><a href="#solution-9" class="headerlink" title="solution"></a>solution</h4><p>设 $f(n)$ 表示有 $n$ 个点的有标号简单无向连通图的个数，$g(n)$ 表示 $n$ 个点的有标号简单无向图的个数，显然有 $g(n) = 2^{\binom n2}$。</p>
<p>一个有标号简单无向图是由若干个连通分量构成的，为了避免重复计数，我们枚举 $1$ 号点所在的连通块的大小（其他点任意连边，不会重复）</p>
<script type="math/tex; mode=display">
\begin{align}
g(n) &= \sum_{i = 1}^n{\binom{n - 1}{i - 1} f(i) g(n - i)} \\
2^{\binom n2} &= \sum_{i = 1}^n{\binom{n - 1}{i - 1} f(i) 2^{\binom{n - i}2}} \\
\frac{2^{\binom n2}}{(n - 1)!} &= \sum_{i = 1}^n{\frac{f(i)}{(i - 1)!} \times \frac{2^{ \binom{n - i}2}}{(n - i)!}}
\end{align}</script><p>定义形式幂级数</p>
<script type="math/tex; mode=display">
\begin{align}
F(x) &= \sum_{n = 0}^\infty \frac{f(n)}{(n - 1)!} x^n \\
G(x) &= \sum_{n = 0}^\infty \frac{2^{ \binom n2}}{n!} x^n \\
H(x) &= \sum_{n = 0}^\infty \frac{2^{ \binom n2}}{(n - 1)!} x^n
\end{align}</script><p>那么有</p>
<script type="math/tex; mode=display">
\begin{align}
H(x) & \equiv F(x) G(x) \pmod{x^{n + 1}} \\
F(x) & \equiv H(x) G^{-1}(x) \pmod{x^{n + 1}}
\end{align}</script><p>把 $H(x)$ 和 $G(x)$ 的逆卷一块就得到了 $F(x)$，再乘上一个 $(n - 1)!$ 就完事了。总复杂度 $O(n \log n)$。</p>
<h4 id="code-9"><a href="#code-9" class="headerlink" title="code"></a>code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">using</span> Poly_t = <span class="type">int</span>[<span class="number">1</span>&lt;&lt;<span class="number">18</span>|<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> mod = <span class="number">1004535809</span>, g = <span class="number">3</span>, invG = <span class="number">334845270</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Pow</span><span class="params">(ll b, ll p = mod - <span class="number">2</span>, ll m = mod)</span></span>;</span><br><span class="line"></span><br><span class="line">Poly_t F, G, G_, to;</span><br><span class="line"><span class="type">int</span> *H = F, fac[<span class="number">130003</span>], invF[<span class="number">130003</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prework</span><span class="params">(<span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">  fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">    fac[i] = <span class="number">1ll</span> * fac[i - <span class="number">1</span>] * i % mod;</span><br><span class="line">  invF[N] = <span class="built_in">Pow</span>(fac[N]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = N; i; --i)</span><br><span class="line">    invF[i - <span class="number">1</span>] = <span class="number">1ll</span> * invF[i] * i % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> *a, <span class="type">int</span> type)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PolyInv</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> *a, <span class="type">int</span> *b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> lim, l;</span><br><span class="line"></span><br><span class="line">  std::cin &gt;&gt; N;</span><br><span class="line">  <span class="built_in">prework</span>(N);</span><br><span class="line">  G[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">    G[i] = <span class="number">1ll</span> * <span class="built_in">Pow</span>(<span class="number">2</span>, <span class="number">1ll</span> * i * (i - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>) * invF[i] % mod;</span><br><span class="line">    H[i] = <span class="number">1ll</span> * <span class="built_in">Pow</span>(<span class="number">2</span>, <span class="number">1ll</span> * i * (i - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>) * invF[i - <span class="number">1</span>] % mod;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">PolyInv</span>(N + <span class="number">1</span>, G, G_);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (lim = <span class="number">1</span>, l = <span class="number">-1</span>; lim &lt;= N &lt;&lt; <span class="number">1</span>; lim &lt;&lt;= <span class="number">1</span>, ++l);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    to[i] = (to[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; l);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">NTT</span>(lim, H, <span class="number">1</span>), <span class="built_in">NTT</span>(lim, G_, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)</span><br><span class="line">    F[i] = <span class="number">1ll</span> * G_[i] * H[i] % mod;</span><br><span class="line">  <span class="built_in">NTT</span>(lim, F, <span class="number">-1</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">1ll</span> * F[N] * fac[N - <span class="number">1</span>] % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="CF662C-Binary-Table"><a href="#CF662C-Binary-Table" class="headerlink" title="CF662C Binary Table"></a><a target="_blank" rel="noopener" href="http://codeforces.com/problemset/problem/662/C">CF662C Binary Table</a></h3><h4 id="problem-9"><a href="#problem-9" class="headerlink" title="problem"></a>problem</h4><p>给定一个 $n \ (1 \le n \le 20)$ 行 $m \ (1 \le m \le 10^6)$ 列的 01 矩阵，每次操作可以选定一行或一列并将其中所有元素取反，求若干次操作后可能的最少的 1 的个数。</p>
<h4 id="solution-10"><a href="#solution-10" class="headerlink" title="solution"></a>solution</h4><p>暴力是这样子的：$2^n$ 枚举每一行是否翻转，每种状态的答案是每一列 0/1 个数的较小值之和。总复杂度 $O(m 2^n)$。</p>
<p>枚举状态 $S$ 表示每一行是否翻转，设 $a_i$ 表示初始矩阵中有多少列状态为 $i$，$b_i$ 表示状态 $i$ 的 0/1 的个数的较小值，$f_i$ 表示枚举到状态 $i$ 时的答案，那么</p>
<script type="math/tex; mode=display">
f_S = \sum_{i = 0}^{2^n - 1}{a_i b_{i \oplus S}}</script><p>也即</p>
<script type="math/tex; mode=display">
f_S = \sum_{i \oplus j = S}{a_i b_j}</script><p>发现这是异或卷积的形式，可以用 FWT 在 $O(n \log n)$ 的时间内求出 $f_{1 \cdots 2^n}$，取最小值就是答案。</p>
<h4 id="code-10"><a href="#code-10" class="headerlink" title="code"></a>code</h4><p>FWT 实现看多项式笔记。本题不需要也不应该取模。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">using</span> Poly_t = ll[<span class="number">1</span>&lt;&lt;<span class="number">20</span>|<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> z[<span class="number">100003</span>];</span><br><span class="line">Poly_t a, b;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> N, N_, M;</span><br><span class="line">  ll* f = a;</span><br><span class="line"></span><br><span class="line">  cin &gt;&gt; N &gt;&gt; M;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; M; ++j)</span><br><span class="line">      <span class="keyword">if</span> (cin.<span class="built_in">get</span>())</span><br><span class="line">        z[j] |= <span class="number">1</span> &lt;&lt; i;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; M; ++i)</span><br><span class="line">    ++a[z[i]];</span><br><span class="line">  N_ = N, N = <span class="number">1</span> &lt;&lt; N;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">    b[i] = b[i &gt;&gt; <span class="number">1</span>] + (i &amp; <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">    b[i] = std::<span class="built_in">min</span>(b[i], N_ - b[i]);</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">XOR</span>(N, a, <span class="number">1</span>), <span class="built_in">XOR</span>(N, b, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">    f[i] = a[i] * b[i];</span><br><span class="line">  <span class="built_in">XOR</span>(N, f, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; *std::<span class="built_in">min_element</span>(f, f + N);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="CF850E-Random-Elections"><a href="#CF850E-Random-Elections" class="headerlink" title="CF850E Random Elections"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF850E">CF850E Random Elections</a></h3><h4 id="problem-10"><a href="#problem-10" class="headerlink" title="problem"></a>problem</h4><p>A, B, C 三人比赛，$2^n \ (1 \le n \le 20)$ 个人投票。<strong>每个人有一个确定的顺序</strong>，他们把票投给顺序靠前的人。</p>
<p>有一个函数 $f(S)$，接受一个长度 $n = 2^k$ 的二进制串 $S$ 并返回 true/false。保证 $f(\neg S_1, \neg S_2, \cdots, \neg S_n) = \neg f(S_1, S_2, \cdots, S_n)$。</p>
<p>比赛结果由 $n$ 个人投票决定，给定 $S$，$S_i$ 表示 $f(i)$ 的取值。询问单循环的三场比赛满足有同一个人连胜两场的方案数。</p>
<h4 id="solution-11"><a href="#solution-11" class="headerlink" title="solution"></a>solution</h4><p>假设 A 连胜两场，答案乘以 $3$ 即可。</p>
<p>设某人两场比赛的决策是 $(x_1, x_2)$，那么可以得到他的决策序列：</p>
<ul>
<li>$(0, 0) \to \text{BCA, CBA}$</li>
<li>$(0, 1) \to \text{BAC}$</li>
<li>$(1, 0) \to \text{CAB}$</li>
<li>$(1, 1) \to \text{ABC, ACB}$</li>
</ul>
<p>发现如果 $x_1 \oplus x_2 = 0$ 就可以对方案数造成 $2$ 的贡献。所有位压在一起那么方案就是 $2^{n - \operatorname{popcount}(S_1 \oplus S_2)}$。</p>
<p>直接枚举是 $O(4^n)$ 的，可以 FWT 预处理出异或值等于 $1 \cdots 2^n$ 的数对个数再统计贡献。</p>
<h4 id="code-11"><a href="#code-11" class="headerlink" title="code"></a>code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> mod = <span class="number">1&#x27;000&#x27;000&#x27;007</span>, inv2 = <span class="number">500&#x27;000&#x27;004</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> N_, <span class="type">int</span>* F)</span> </span>&#123; <span class="comment">// F[0...2^N_)</span></span><br><span class="line">  <span class="type">int</span> N = <span class="number">1</span> &lt;&lt; N_, ans = <span class="number">0</span>, *popcnt = <span class="keyword">new</span> <span class="type">int</span>[N];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">XOR</span>(N, F, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">    F[i] = <span class="number">1ll</span> * F[i] * F[i] % mod;</span><br><span class="line">  <span class="built_in">XOR</span>(N, F, inv2);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">    popcnt[i] = popcnt[i &gt;&gt; <span class="number">1</span>] + (i &amp; <span class="number">1</span>);</span><br><span class="line">    ans = (ans + <span class="number">1ll</span> * F[i] * (<span class="number">1</span> &lt;&lt; (N_ - popcnt[i]))) % mod;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">3ll</span> * ans % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="P5816-CQOI2010-内部白点"><a href="#P5816-CQOI2010-内部白点" class="headerlink" title="P5816 [CQOI2010]内部白点"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5816">P5816 [CQOI2010]内部白点</a></h4><h4 id="problem-11"><a href="#problem-11" class="headerlink" title="problem"></a>problem</h4><p>初始时网格图里有 $n \ (1 \le n \le 10^5)$ 个黑点，所有其他整数点都是白色的。每秒钟所有<strong>内部白点</strong>同时变黑，直到不存在内部白点为止。计算最终网格图中的黑点个数或判断变化不会结束。</p>
<p><strong>内部白点的定义</strong>：一个白色的整点是内部白点当且仅当其所在的水平线的左边和右边各至少有一个黑点，且所在竖直线的上边和下边各至少有一个黑点。形式化地，点 $P(x, y)$ 是黑点当且仅当存在黑点 $(x_1, y), (x_2, y), (x, y_1), (x, y_2)$ 满足 $x_1 &lt; x &lt; x_2, y_1 &lt; x &lt; y_2$。</p>
<h4 id="solution-12"><a href="#solution-12" class="headerlink" title="solution"></a>solution</h4><p>👴又回来整 DS 🌶！</p>
<p>首先这题变化是一定会结束的，并且会在一次变化内结束<del>（好像很显然的样子）</del>，因为 新产生的黑点能够产生的黑点 一定是 原有黑点能产生的黑点 的子集。</p>
<p>我们对于每个 $x$ 坐标，记录 $y$ 坐标最小和最大的点，对于 $y$ 最小/最大的点打标记 $1 / -1$，再对每对 $x$ 坐标相同的点连一条水平线段。</p>
<p>这样从下向上扫描，对于每个标记修改相应位置的点值；对于每条线段统计区间和，即可得到答案。</p>
<h4 id="code-12"><a href="#code-12" class="headerlink" title="code"></a>code</h4><p>这个做法除去 ds 外时间常数并不好；空间常数会好一些；在碰到重复点时会暴毙，好在这题保证了没有重复点。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">  <span class="type">int</span> x, y;</span><br><span class="line">&#125; z[<span class="number">100003</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmpx</span><span class="params">(Point lhs, Point rhs)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">tie</span>(lhs.x, lhs.y) &lt; std::<span class="built_in">tie</span>(rhs.x, rhs.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmpy</span><span class="params">(Point lhs, Point rhs)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">tie</span>(lhs.y, lhs.x) &lt; std::<span class="built_in">tie</span>(rhs.y, rhs.x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">  <span class="type">int</span> l, r, y, k;</span><br><span class="line"></span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>&lt;(Line rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">tie</span>(y, k) &lt; std::<span class="built_in">tie</span>(rhs.y, rhs.k);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; e[<span class="number">300003</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> N_, z_[<span class="number">100003</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> BIT &#123;</span><br><span class="line">  <span class="type">int</span> t[<span class="number">100003</span>];</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Modify</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> v)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">Query</span><span class="params">(<span class="type">int</span> p)</span></span>;</span><br><span class="line">&#125; <span class="comment">// BIT</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> N, M = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  cin &gt;&gt; N;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">    cin &gt;&gt; z[i].x &gt;&gt; z[i].y;</span><br><span class="line">    z_[i] = z[i].x;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  std::<span class="built_in">sort</span>(z_ + <span class="number">1</span>, z_ + N + <span class="number">1</span>);</span><br><span class="line">  N_ = std::<span class="built_in">unique</span>(z_ + <span class="number">1</span>, z_ + N + <span class="number">1</span>) - z_ - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">    z[i].x = std::<span class="built_in">lower_bound</span>(z_ + <span class="number">1</span>, z_ + N_ + <span class="number">1</span>, z[i].x) - z_;</span><br><span class="line"></span><br><span class="line">  std::<span class="built_in">sort</span>(z + <span class="number">1</span>, z + N + <span class="number">1</span>, cmpx);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; ++i)</span><br><span class="line">    <span class="keyword">if</span> (z[i].x == z[i + <span class="number">1</span>].x) &#123;</span><br><span class="line">      e[++M] = &#123;z[i].x, <span class="number">0</span>, z[i].y, <span class="number">1</span>&#125;;</span><br><span class="line">      e[++M] = &#123;z[i + <span class="number">1</span>].x, <span class="number">0</span>, z[i + <span class="number">1</span>].y, <span class="number">-1</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  std::<span class="built_in">sort</span>(z + <span class="number">1</span>, z + N + <span class="number">1</span>, cmpy);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; ++i)</span><br><span class="line">    <span class="keyword">if</span> (z[i].y == z[i + <span class="number">1</span>].y)</span><br><span class="line">      e[++M] = &#123;z[i].x, z[i + <span class="number">1</span>].x, z[i].y, <span class="number">0</span>&#125;;</span><br><span class="line">  std::<span class="built_in">sort</span>(e + <span class="number">1</span>, e + M + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= M; ++i)</span><br><span class="line">    <span class="keyword">if</span> (e[i].k) BIT::<span class="built_in">Modify</span>(e[i].l, e[i].k);</span><br><span class="line">    <span class="keyword">else</span> ans += BIT::<span class="built_in">Query</span>(e[i].r - <span class="number">1</span>) - BIT::<span class="built_in">Query</span>(e[i].l);</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; ans + N &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>写于 2020/4/30 22:46</p>
<p>这个月结束了，可以说是放假来最不颓的一个月（其实颓得也蛮多的）</p>
<p>先整了几道题，又重学了数论、从零开始学了多项式，统共码了 2w+ 字的博文。</p>
<p>基础算法和思维比较薄弱，希望下个月能加强下。</p>
<p>下个月这时候说不定就要退役了。</p>
<p>希望能够不辜负自己吧。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">fa_555</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.fa555.tech/2020/2020-Apr-Records/">https://blog.fa555.tech/2020/2020-Apr-Records/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.fa555.tech">fa_555's Blog</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/%E6%9D%9C%E6%95%99%E7%AD%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fa fa-chevron-left">  </i><span>杜教筛学习笔记</span></a></div><div class="next-post pull-right"><a href="/2020/%E6%9F%90At%E7%9A%84dp%E5%9C%BA/"><span>某 AtCoder 的 dp 场</span><i class="fa fa-chevron-right"></i></a></div></nav><div class="post-adv"></div></div></div><footer class="footer-bg" style="background-image: url(/files/topimg/johannes-plenio-E-Zuyev2XWo-unsplash.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2024 By fa_555</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>